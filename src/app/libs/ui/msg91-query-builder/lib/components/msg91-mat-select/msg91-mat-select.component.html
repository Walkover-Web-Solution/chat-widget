<mat-form-field [appearance]="appearance" [ngClass]="class">
    <mat-label *ngIf="showLabel">{{ labelText }}</mat-label>
    <mat-select
        [formControl]="control"
        [placeholder]="placeholder"
        (selectionChange)="!withPreviousValueInOnChange ? controlValueChange($event.value) : null"
        [disableOptionCentering]="disableOptionCentering"
    >
        <div
            class="sticky bg-white"
            style="width: 205px"
            [ngStyle]="{ 'display': !enableSearch ? 'block' : 'inline-block' }"
        >
            <msg91-lib-search
                *ngIf="enableSearch"
                [placeholder]="searchSettings.placeHolder"
                [matFormFieldClass]="'no-padding remove-form-field-border w-100 border-bottom'"
                (inputChanges)="search($event)"
                [value]="searchControl.value"
            ></msg91-lib-search>
        </div>
        <mat-option *ngFor="let option of filteredOptions | async" [value]="option[keyToUseForValue] ?? ''">
            {{ option[keyToUseShowLabel] ?? option }}
        </mat-option>
        <mat-option *ngIf="enableSearch && options.length && !(filteredOptions | async).length">
            No entries found</mat-option
        >
    </mat-select>
    <ng-container [ngTemplateOutlet]="error" *ngIf="showError && showErrorIntoMatFormField"> </ng-container>
</mat-form-field>
<ng-container [ngTemplateOutlet]="error" *ngIf="showError && !showErrorIntoMatFormField"> </ng-container>

<ng-template #error let-errors>
    <ng-container *ngIf="control?.touched">
        <ng-container *ngFor="let error of controlErrorsMessage || {} | keyvalue">
            <mat-error *ngIf="control.errors?.[error.key]">{{ error.value }}</mat-error>
        </ng-container>
    </ng-container>
</ng-template>
