<div class="d-flex col-gap-3 align-items-start">
    <mat-form-field [appearance]="formFieldAppearance" [ngClass]="cssClass">
        <mat-label
            >{{ labelName }}
            <span *ngIf="showRequired" class="text-danger">*</span>
        </mat-label>
        <input
            type="text"
            matInput
            [matAutocomplete]="segmentAutoComplete"
            #segmentInput
            [formControl]="segmentForm"
            #segmentTrigger="matAutocompleteTrigger"
            [msg91CloseDropdownOnEscape]="segmentTrigger"
            [readonly]="readOnly ? 'readonly' : null"
            [placeholder]="placeHolder"
        />
        <mat-autocomplete
            #segmentAutoComplete="matAutocomplete"
            (optionSelected)="handleSegmentoSelection($event)"
            [displayWith]="segmentDisplayFunction"
        >
            <msg91-cdk-scroll (fetchNextPage)="fetchNextSegmentPage()">
                <mat-option value="" *ngIf="!hideCreateSegment">
                    <a href="javascript:void(0);" class="text-primary fw-bold d-flex align-items-center"
                        ><mat-icon class="mat-icon-16 mr-0">add</mat-icon>&nbsp;Create Segment</a
                    >
                </mat-option>
                <mat-option disabled value="" *ngIf="!(segments$ | async)?.length"> No Segment Found </mat-option>
                <ng-container *ngFor="let segment of segments$ | async">
                    <mat-option
                        [value]="segment"
                        *ngIf="
                            showAiSegment
                                ? true
                                : showAiQuerySegment
                                  ? segment.is_ai_query
                                  : showAllSegment
                                    ? true
                                    : !segment.is_ai_query
                        "
                    >
                        {{ segment.name }}
                    </mat-option>
                </ng-container>
            </msg91-cdk-scroll>
        </mat-autocomplete>
        <div matSuffix class="d-flex align-items-center">
            <button
                mat-icon-button
                *ngIf="segmentForm.value && !segmentForm.disabled"
                class="cursor-pointer icon-btn-md"
                color="primary"
                (click)="clearSegment()"
            >
                <mat-icon class="mat-icon-20 text-dark">close</mat-icon>
            </button>
            <mat-spinner *ngIf="(fetchPhonebookInProgress$ | async) && showApiCallLoader" [diameter]="20"></mat-spinner>
        </div>
        <mat-error *ngIf="segmentForm.touched">
            <mat-error *ngIf="segmentForm.errors?.required"> Segment field is required. </mat-error>
            <mat-error *ngIf="segmentForm?.errors?.elementExistsInList"> Select Segment from dropdown </mat-error>
        </mat-error>
    </mat-form-field>
    <button
        mat-mini-fab
        class="mt-1"
        (click)="fetchSegment(params)"
        matTooltip="Refresh"
        matTooltipPosition="above"
        [msg91ButtonLoader]="fetchPhonebookInProgress$ | async"
        [wrapperClass]="'mt-1'"
        *ngIf="showRefresh"
    >
        <mat-icon class="mat-icon-20" fontIcon="refresh"></mat-icon>
    </button>
</div>
