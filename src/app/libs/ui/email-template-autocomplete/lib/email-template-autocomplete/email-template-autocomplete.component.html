<div class="d-flex col-gap-3 align-items-start">
    <mat-form-field [class]="matFormFieldClass" [floatLabel]="fromCampaign ? 'auto' : 'always'">
        <mat-label>Select Template</mat-label>
        <input
            type="text"
            matInput
            [matAutocomplete]="emailTemplateAutoComplete"
            #emailTemplateInput
            [formControl]="emailTemplateFormControl"
            #templateTrigger="matAutocompleteTrigger"
            [msg91CloseDropdownOnEscape]="templateTrigger"
            placeholder=" Select Template"
        />
        <mat-autocomplete
            #emailTemplateAutoComplete="matAutocomplete"
            (optionSelected)="selectTemplate()"
            [displayWith]="templateDisplayFunction"
            msg91AutoSelectDropdown
            (setControlValue)="
                emailTemplateFormControl.setValue($event); emailTemplateFormControl.markAsDirty(); selectTemplate()
            "
            [disableAutoSelectDirective]="disableAutoSelectDirective"
        >
            <msg91-cdk-scroll (fetchNextPage)="fetchNextTemplatePage()">
                <a
                    class="flat-primary-light my-2 mx-3"
                    *ngIf="createTemplateURL"
                    mat-flat-button
                    [href]="createTemplateURL"
                    target="_blank"
                    >Create Email Template</a
                >
                <!-- <mat-option value="" disabled>-- Select template --</mat-option> -->
                <mat-option disabled value="" *ngIf="!templates?.length"> No Template Found </mat-option>
                <mat-option [value]="temp" *ngFor="let temp of templates">
                    {{ temp?.templateName ?? temp.slug }}
                </mat-option>
            </msg91-cdk-scroll>
        </mat-autocomplete>
        <button
            mat-icon-button
            matSuffix
            *ngIf="showCloseTemplate"
            class="cursor-pointer icon-btn-md"
            color="primary"
            (click)="clearTemplate()"
        >
            <mat-icon class="mat-icon-20 text-dark">close</mat-icon>
        </button>
        <mat-error>
            <ng-container *ngIf="showPurchasePlanText$ | async; else subscriptionPresent">
                <mat-error (click)="noSubscription.emit(subscriptionBasedServices.Email)" class="cursor-pointer"
                    >Click here to subscribe to an Email plan.</mat-error
                >
            </ng-container>
            <ng-template #subscriptionPresent>
                <ng-container *ngIf="emailTemplateFormControl.touched">
                    <mat-error *ngIf="emailTemplateFormControl.errors?.required">
                        Template field is required.
                    </mat-error>
                    <mat-error *ngIf="emailTemplateFormControl.errors?.elementExistsInList">
                        Select Template from dropdown.
                    </mat-error>
                    <mat-error *ngIf="emailTemplateFormControl.errors?.noVariableFound as noVariableFoundError">
                        {{ noVariableFoundError }}
                    </mat-error>
                </ng-container>
            </ng-template>
        </mat-error>
    </mat-form-field>
    <button
        mat-mini-fab
        class="mt-1"
        (click)="refreshTemplate()"
        matTooltip="Refresh"
        matTooltipPosition="above"
        [msg91ButtonLoader]="apiInProgress$ | async"
        [wrapperClass]="'mt-1'"
    >
        <mat-icon class="mat-icon-20" fontIcon="refresh"></mat-icon>
    </button>
</div>
