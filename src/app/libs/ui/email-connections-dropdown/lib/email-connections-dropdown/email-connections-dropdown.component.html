<div class="d-flex col-gap-3 align-items-start">
    <mat-form-field appearance="outline" class="w-xs-100" [class]="formFieldClass">
        <mat-label>{{ label }}</mat-label>
        <mat-select
            class="fw-bold"
            panelClass="round-dropdown"
            [placeholder]="'Select ' + label"
            [formControl]="connectionFormControl"
        >
            <a
                *ngIf="createConnectionURL"
                class="flat-primary-light my-2 mx-3"
                mat-flat-button
                [href]="createConnectionURL"
                target="_blank"
            >
                Add Connection
            </a>
            <mat-option *ngIf="!(connections | async)?.length" disabled> -- No Connection Found -- </mat-option>
            <mat-option [value]="connection?.id" *ngFor="let connection of connections | async">
                <ng-container *ngIf="connection; then connectionItem"></ng-container>
            </mat-option>
            <mat-select-trigger>
                <ng-container *ngIf="selectedConnection | async; then connectionItem"></ng-container>
            </mat-select-trigger>
        </mat-select>
        <mat-error *ngIf="connectionFormControl?.touched">
            <mat-error *ngIf="connectionFormControl?.errors?.required"> {{ label }} is required. </mat-error>
        </mat-error>
        <mat-hint *ngIf="selectedConnection | async as selectedConn">
            <span class="fw-bolder">
                {{ selectedConn?.name }}
            </span>
            {{ selectedConn?.email }}
        </mat-hint>
    </mat-form-field>
    <button
        mat-mini-fab
        class="mt-1"
        (click)="getConnections()"
        matTooltip="Refresh"
        matTooltipPosition="above"
        [msg91ButtonLoader]="isConnectionLoading | async"
        [wrapperClass]="'mt-1'"
    >
        <mat-icon class="mat-icon-20" fontIcon="refresh"></mat-icon>
    </button>
</div>

<ng-template #connectionItem let-connection>
    <div class="d-flex align-items-center">
        <img [src]="providersIconPath?.[connection?.provider]" [alt]="provider" width="20" height="20" loading="lazy" />
        <span class="pl-2">{{ connection.email }}</span>
    </div>
</ng-template>
